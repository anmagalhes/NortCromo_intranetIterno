<!DOCTYPE html>
<html lang="pt-br">
<head>
  {% include 'head.html' %}
  <script src="https://code.jquery.com/jquery-3.6.4.js"></script>

</head>
<body>
    <div class="container">
    <div id="cabecalho_NorthCromo" class="custom-header">
      <header>
        <div class="logo-container">
          <img class="logo-northcromo" src="https://drive.google.com/uc?export=view&id=1-grKAm790rFePojbqFxCeNXy4rHzrV4j" alt="Logo da NorthCromo" width="35" />
          <h2>
            <span class="company-name">NORTH CROMO</span> - 
            <span class="system-name">SISTEMA CONTROLES INTERNO</span> - 
            <span class="additional-info">( INSPERSÃO )</span>
          </h2>
        </div>
        <div class="hamburger-menu" id="hamburgerMenu">
          ☰ MENU
        </div>
      </header>
    </div>

    {% include 'funcoes_comuns.html' %}

    <nav class="sidebar">

      <div class="menu" id="menu">
          <div class="menu-top">
            <img
              class="logo-northcromo"
              src="https://drive.google.com/uc?export=view&id=1-grKAm790rFePojbqFxCeNXy4rHzrV4j"
              alt="Logo da NorthCromo"
            />
            <button
              class="mui-btn mui-btn--raised toggle-menu-btn"
              id="toggleMenuBtn"
            >
              →
            </button>
          </div>
          <button
            class="mui-btn mui-btn--raised close-menu-btn"
            id="closeMenuBtn"
          >
           <span class="menu-text">Fechar</span>
          </button>

          <!-- Adicionando o contêiner para informações específicas do menu -->
          <ul>
            <li class="expandable hide-text">
            <div class="menu-header">
              <i class="material-icons">folder</i>
              <!-- ícone de pasta para Cadastro -->
              <span class="menu-text" id="cadastroText"> Cadastro</span>
              <i
                class="material-icons toggle-submenu"
                style="
                  transition: transform 0.3s;
                  font-family: 'Material Icons';
                "
                >arrow_drop_down</i
              >
              </div>
              <ul class="submenu">
                <li>
                  <i
                    class="material-icons"
                    onclick="submenu_muda_de_tela('cadastrar_usuario.html', event)"
                    >person_add</i
                  >
                  <span class="menu-text"> Cadastrar Usuário </span>
                </li>

                <li>
                  <i
                    class="material-icons"
                    onclick="submenu_muda_de_tela('funcionarios.html',event)"
                    >person</i
                  >
                  <span
                    class="menu-text"
                    onclick="submenu_muda_de_tela('funcionarios.html',event)"
                  >
                    Funcionários</span
                  >
                </li>
                <li>
                  <i class="material-icons">account_balance</i>
                  <span class="menu-text">Centro de Custo</span>
                </li>
                <li>
                  <i class="material-icons">build</i
                  ><span class="menu-text">Obras</span>
                </li>
                <li>
                  <i class="material-icons">account_circle</i>
                  <span class="menu-text">Usuários</span>
                </li>
                <li>
                  <i class="material-icons">shopping_basket</i>
                  <span class="menu-text">Produto</span>
                </li>
                <li>
                  <i class="material-icons">label</i>
                  <span class="menu-text">Categoria</span>
                </li>
                <li>
                  <i class="material-icons">dashboard</i>
                  <span class="menu-text">Área</span>
                </li>
                <li>
                  <i class="material-icons">store</i>
                  <span class="menu-text">Cliente</span>
                </li>
                <li>
                  <i class="material-icons">construction</i>
                  <span class="menu-text">Mestre de Obras</span>
                </li>
                <li>
                  <i class="material-icons">business</i>
                  <span class="menu-text">Setor</span>
                </li>
              </ul>
            </li>

            <li class="expandable hide-text desktop-menu-item" data-template="recebimento.html">
              <div class="menu-header">
                <i class="material-icons">input</i>
                <span class="menu-text"> Recebimento</span>
                <i class="material-icons toggle-submenu invisible-icon"
                  >arrow_drop_down</i
                >
              </div>
            </li>
            
            <li class="expandable hide-text">
                <div class="menu-header">
              <i class="material-icons">build</i>
              <span class="menu-text"> Desmontagem</span>
              <i
                class="material-icons toggle-submenu"
                style="
                  transition: transform 0.3s;
                  font-family: 'Material Icons';
                "
                >arrow_drop_down</i
              >
            </div>
              <ul class="submenu">
                <li  onclick="submenu_muda_de_tela('checklist.html', event)" >
                  <i class="material-icons"
                  >playlist_add_check</i>
                  <span class="menu-text"
                  > checklist</span>
                </li>
              </ul>
            </li>

            <li class="expandable hide-text">
                <div class="menu-header">
                    <i class="material-icons">code</i>
                    <span class="menu-text"> Programação</span>
                    <i class="material-icons toggle-submenu" style="transition: transform 0.3s; font-family: 'Material Icons';">arrow_drop_down</i>
                </div>
                <ul class="submenu">
                    <li>
                        <i class="material-icons"
                        onclick="submenu_muda_de_tela('novas_Tarefas.html', event)"
                        >playlist_add</i>
                        <span class="menu-text"
                        onclick="submenu_muda_de_tela('novas_Tarefas.html', event)"
                        > Apontamento de Tarefas</span>
                    </li>
                    <li>
                        <i class="material-icons">send</i>
                        <span class="menu-text"> Lançamento p/ Produção</span>
                    </li>
                    <li>
                        <i class="material-icons">update</i>
                        <span class="menu-text"> Andamento na Produção</span>
                    </li>
                </ul>
            </li>
            
          
            <li class="expandable hide-text">
              <div class="menu-header">
                <i class="material-icons">shopping_cart</i>
                <span class="menu-text"> Compras</span>
                <i
                  class="material-icons toggle-submenu"
                  style="
                    transition: transform 0.3s;
                    font-family: 'Material Icons';
                  "
                  >arrow_drop_down</i
                >
              </div>
              <ul class="submenu">
                <li>
                  <i class="material-icons">note_add</i>
                  <span class="menu-text"> Nova Compra</span>
                </li>
                <li>
                  <i class="material-icons">history</i>
                  <span class="menu-text"> Histórico de Compras</span>
                </li>
                <li>
                  <i class="material-icons">group</i>
                  <span class="menu-text"> Fornecedores</span>
                </li>
              </ul>
            </li>

            <li class="expandable" onclick="muda_de_tela('index_1.html')">
              <div class="menu-header">
                <i class="material-icons">store</i>
                <span class="menu-text"> Clientes</span>
                <!-- Um ícone invisível para alinhar corretamente o texto -->
                <i class="material-icons invisible-icon">arrow_drop_down</i>
              </div>
            </li>
            <li class="expandable hide-text">
              <i class="material-icons">store</i>
              <span class="menu-text"> Almoxarifado</span>
              <i
                class="material-icons toggle-submenu"
                style="
                  transition: transform 0.3s;
                  font-family: 'Material Icons';
                "
                >arrow_drop_down</i
              >
              <ul class="submenu">
                <li>
                  <i class="material-icons">input</i>
                  <span class="menu-text"> Entrada de Materiais</span>
                </li>
                <li>
                  <i class="material-icons">output</i>
                  <span class="menu-text"> Saída de Materiais</span>
                </li>
                <li>
                  <i class="material-icons">report_problem</i>
                  <span class="menu-text"> Controle</span>
                </li>
                <li>
                  <i class="material-icons">swap_horiz</i>
                  <span class="menu-text"> Transferências</span>
                </li>
                <li>
                  <i class="material-icons">assessment</i>
                  <span class="menu-text"> Relatórios</span>
                </li>
                <li>
                  <i class="material-icons">construction</i>
                  <span class="menu-text"> Estoque Obras</span>
                </li>
                <li>
                  <i class="material-icons">home_work</i>
                  <span class="menu-text"> Estoque Depósitos</span>
                </li>
              </ul>
            </li>
            <li class="expandable" onclick="muda_de_tela('index_3.html')">
              <div class="menu-header">
                <i class="material-icons">account_balance_wallet</i>
                <span class="menu-text"> Vendas</span>
                <i class="material-icons toggle-submenu invisible-icon"
                  >arrow_drop_down</i
                >
              </div>
            </li>
            
            <li class="expandable" onclick="logout()">
              <i class="material-icons">exit_to_app</i>
              <span class="menu-text"> Sair</span>
            </li>

          </ul>
        </div>
      </nav>

      <section class="main-section" id="mainContent">
        <header class="header">
           
        </header>
        
    </section>
    

    </div>
    <!-- Fim da div #divide_em_dois -->
    <i class="material-icons">build</i>
    Obras
    <i class="material-icons toggle-submenu invisible-icon">arrow_drop_down</i>
    </div>
    </li>
    
    <li class="expandable desktop-menu-item" onclick="logout()">
    <div class="menu-header">
    <i class="material-icons">exit_to_app</i>
    Sair
    <i class="material-icons toggle-submenu invisible-icon">arrow_drop_down</i>
    </div>
    </li>
    </ul>
    </div>
    <!-- Fim da div .menu-mobile -->
    {% include 'funcoes_comuns.html' %}

    <div id="menu-flutuante" onclick="toggleMenuLateralFlutuante()">
      <i class="material-icons">menu</i>
  </div>

  <!-- Overlay do Menu Mobile -->
  <div id="menu-overlay"></div>

<!-- Menu Flutuante Lateral -->
<div id="lado-esquerdo-flutuante">

  <!-- Menu Mobile -->
  <div class="menu-mobile">
      <!-- Conteúdo do menu móvel -->
      <ul>
          <li class="expandable desktop-menu-item" data-template="controle_presenca.html">
              <div class="menu-header">
                  <i class="material-icons">check_circle</i>
                  Presenças
                  <i class="material-icons toggle-submenu invisible-icon">arrow_drop_down</i>
              </div>
          </li>

          <li class="expandable desktop-menu-item" data-template="lista_obras.html">
              <div class="menu-header">
<script>
  try {
      $(document).ready(function () {

          // Evento de clique para abrir o menu e fechar
          $("#toggleMenuBtn").click(function () {
            console.log('Botão do menu clicado')
            $("#menu").toggleClass("change2");
          });

// Evento de clique nos itens do menu
$("#menu ul li.expandable").on("click", function (e) {
    try {
      const el = e.currentTarget;

      if (el) {
        // Alternar a classe active no item clicado
        $(el).toggleClass("active");
        //setSubmenuHeight();

         // Alternar a classe change2 no item clicado e seu submenu
         $(el).find(".submenu").toggleClass("change2");

        // Remover a classe active de outros itens do menu
        $("#menu ul li.expandable").not(el).removeClass("active");

        // Alternar a classe change2 no item clicado e seu submenu
        $(el).find(".submenu").toggleClass("change2");

        // Alternar a seta para cima ou para baixo com base na existência da classe change2
        $(el).find(".toggle-submenu").toggleClass("arrow-up", $(el).find(".submenu").hasClass("change2"));
      } else {
        console.error("Elemento não encontrado.");
      }
    } catch (error) {
      console.error("Erro no clique do item do menu:", error);
    }
  });

  // Impede a propagação do evento de clique para o pai
  $("#menu ul li.expandable .submenu").on("click", function (e) {
    e.stopPropagation();
  });

  // Fechar o menu ao clicar no botão de fechar
  $("#closeMenuBtn").click(function () {
    $("#menu").removeClass("change2");
    // Remover a classe active de todos os itens do menu ao fechar
    $("#menu ul li.expandable").removeClass("active");
  });

  // Evento de clique para abrir o menu e fechar
  $(".hamburger-menu").click(function () {
    console.log('Botão do menu clicado');

    // Alternar a classe change2 no elemento com a classe container
    $(".container").toggleClass("change2");
  });
     
        
          // Elementos do menu mobile
          const menuOverlay = document.getElementById("menu-overlay");
          const menuMobile = document.querySelector(".menu-mobile");
          const openMenuFloatingBtnMobile = document.getElementById("openMenuFloatingBtnMobile");
          const toggleMenuBtn = document.getElementById("toggleMenuBtn");
          const menuFlutuanteBtn = document.getElementById("menu-flutuante");
         
         // Adicione um identificador único a cada ícone do Material Design
          const iconButtons = document.querySelectorAll(".material-icons");

          iconButtons.forEach((button) => {
          button.addEventListener("click", function () {
              const template = this.parentElement.getAttribute("data-template");
              loadContent(template);
              toggleMenuState(this.innerText);
          });
      });

          // Event listener para o botão de menu flutuante
          if (menuFlutuanteBtn) {
              menuFlutuanteBtn.addEventListener("click", function () {
                  toggleMobileMenu();
              });
          }

          // Event listener para o botão de abertura de menu no mobile
          if (openMenuFloatingBtnMobile) {
              openMenuFloatingBtnMobile.addEventListener("click", function () {
                  toggleMobileMenu();
              });
          }

          // Event listener para o botão de toggle do menu no desktop
          if (toggleMenuBtn) {
              toggleMenuBtn.addEventListener("click", function () {
                  toggleMobileMenu();
              });
          }

          // Função para alternar visibilidade do menu mobile
          function toggleMenuMobile() {
              menuOverlay.style.display = menuMobile.style.display === "block" ? "none" : "block";
              menuMobile.style.display = menuMobile.style.display === "block" ? "none" : "block";
          }

          // Função para abrir o menu
          function abrirMenu() {
              $("#menu-lateral").toggleClass("open-menu");
          }

          // Função para alternar visibilidade do menu no mobile
          function toggleMobileMenu() {
              $("#lado_esquerdo").toggleClass("open");
          }

          // Verifica se a tela é mobile
          const isMobile = window.innerWidth <= 768;
          if (isMobile) {
              $("#openMenuBtn").on("click", toggleMobileMenu);
              $("#toggleMenuBtn, .submenu li").on("click", toggleMobileMenu);
          }

          // Event listener para itens do menu expansível
          $(".expandable").click(function () {
              try {
                  $(this).toggleClass("active");
                  $(this).children(".submenu").toggle();
                  $(this).find(".toggle-submenu").toggleClass("rotated");
                  $(this).children(".menu-text").toggle();
              } catch (error) {
                  console.error("Error in expandable click:", error);
              }
          });

          
          // Função para carregar conteúdo
          function loadContent(template) {
              try {
                  console.log("Carregando conteúdo para o template:", template);
                  $.ajax({
                      url: my_url() + "muda_de_tela",
                      type: "POST",
                      data: {
                          qual_template: template,
                      },
                      success: function (response) {
                          $("#mainContent").html(response);
                          //updatePageTitle(pageTitle);
                      },
                      error: function (response) {
                          $("#mainContent").html("Error");
                      },
                  }).done(function (data) {});
              } catch (error) {
                  console.error("Error in loadContent:", error);
              }
          }

            function updatePageTitle(title) {
            $("#pageTitle").text(title);
        }

          // Event listener para itens do menu no desktop
          $(".desktop-menu-item").click(function () {
              try {
                  const template = $(this).attr("data-template");
                  loadContent(template);
                  $("#menu").css("left", "-260px");
              } catch (error) {
                  console.error("Error in desktop-menu-item click:", error);
              }
          });

          // Event listener para itens do submenu
          $(document).on("click", ".submenu li", function () {
        try {
            closeMobileMenu();
            loadContent($(this).attr("data-template"));
        } catch (error) {
            console.error("Error in submenu li click:", error);
        }
    });

      });
  } catch (error) {
      console.error("Error in document ready:", error);
  }

  // Função para mudar de tela na seção de presença
  function muda_de_tela_presenca(x) {
      try {
          alert("Função muda_de_tela_presenca chamada com: " + x);
          $.ajax({
              url: my_url() + "muda_de_tela_presenca",
              type: "POST",
              data: {
                  qual_template: x,
              },
              success: function (response) {
                  $("#mainContent").html(response);
              },
              error: function (response) {
                  $("#mainContent").html("Error");
              },
          }).done(function (data) {});
      } catch (error) {
          console.error("Error in muda_de_tela_presenca:", error);
      }
  }

  // Função para mudar de tela
  function muda_de_tela(x) {
      try {
          alert("Função muda_de_tela chamada com: " + x);
          $.ajax({
              url: my_url() + "muda_de_tela",
              type: "POST",
              data: {
                  qual_template: x,
              },
              success: function (response) {
                  $("#mainContent").html(response);
              },
              error: function (response) {
                  $("#mainContent").html("Error");
              },
          }).done(function (data) {});
      } catch (error) {
          console.error("Error in muda_de_tela:", error);
      }
  }

  // Função para mudar de tela no submenu
  function submenu_muda_de_tela(x, event) {
      try {
          event.preventDefault();
          event.stopPropagation();

          console.log('Função submenu_muda_de_tela chamada com:', x);

          $.ajax({
              url: "/submenu_muda_de_tela",
              type: "POST",
              data: { qual_template: x },
              success: function (response) {
                  $("#mainContent").html(response);
              },
              error: function (response) {
                  $("#mainContent").html("Error");
              },
          }).done(function (data) {
              $(event.target).closest(".submenu").hide();
          });
      } catch (error) {
          console.error("Error in submenu_muda_de_tela:", error);
      }
  }

  // Elementos globais
  const menu = document.getElementById("menu");
  const container = document.getElementById("container");
  const ladoDireito = document.getElementById("lado_direito");
  const toggleMenuBtn = document.getElementById("toggleMenuBtn");
  const openMenuBtn = document.getElementById("openMenuBtn");
  const closeMenuBtn = document.getElementById("closeMenuBtn");
  const submenus = document.querySelectorAll(".submenu");

  // Função para alternar estado do menu
  function toggleMenuState(menuText) {
      try {
          mainSelection = selection;
          
            // Chame a função loadContent com a seleção atual
            loadContent(mainSelection);

        console.log("Seleção principal:", mainSelection);

      } catch (error) {
          console.error("Error in toggleMenuState:", error);
      }
  }

  // Event listeners para os botões de toggle do menu
  toggleMenuBtn.addEventListener("click", toggleMenuState);
  //openMenuBtn.addEventListener("click", toggleMenuState);
  closeMenuBtn.addEventListener("click", toggleMenuState);

  closeMenuBtn.addEventListener("click", toggleMenuVisibility);

      
  // Event listener para o menu
  menu.addEventListener("click", function (event) {
      try {
        const target = event.target;
        const submenu = target.nextElementSibling;

          // Lógica para lidar com cliques no cabeçalho do menu
    if (target.classList.contains("menu-header") && submenu) {
      submenu.classList.toggle("show-submenu");
      const toggleIcon = target.querySelector(".toggle-submenu");
      toggleIcon.innerText = submenu.classList.contains("show-submenu") ? "arrow_drop_up" : "arrow_drop_down";
    }

    // Remover seleção de itens do menu
    document
      .querySelectorAll('[data-selected="true"]')
      .forEach((item) => item.removeAttribute("data-selected"));

    // Adicionar seleção ao item clicado
    if (
      target.tagName === "LI" &&
      !target.nextElementSibling.classList.contains("submenu")
    ) {
      target.setAttribute("data-selected", "true");
    }
  } catch (error) {
    console.error("Error in menu click:", error);
  }
});

  // Event listener para carregamento inicial
  document.addEventListener("DOMContentLoaded", function () {
      try {
          const toggleButtons = document.querySelectorAll(".toggle-submenu");
          toggleButtons.forEach((button) => {
              button.addEventListener("click", function () {
                  const submenu = this.parentElement.nextElementSibling;
                  if (
                      submenu.style.display === "block" ||
                      submenu.style.display === ""
                  ) {
                      submenu.style.display = "none";
                      this.innerText = "arrow_drop_down";
                  } else {
                      submenu.style.display = "block";
                      this.innerText = "arrow_drop_up";
                  }
              });
          });
      } catch (error) {
          console.error("Error in DOMContentLoaded event:", error);
      }
  });

  // Event listener para itens do menu no mobile
  $(".mobile-menu-item").click(function () {
      abrirMenu();
  });

  // Função para alternar visibilidade do menu lateral flutuante
  function toggleMenuLateralFlutuante() {
      $("#lado-esquerdo-flutuante").toggleClass("open-menu");
      $("#menu-overlay").toggleClass("menu-open");
  }

  // Event listener para fechar o menu lateral flutuante quando um item é clicado
  $("#lado-esquerdo-flutuante ul li").click(function () {
      toggleMenuLateralFlutuante();
  });


  // Função para alternar a visibilidade do menu
  function toggleMenuVisibility() {
    //var menu = document.getElementById("lado_esquerdo");
    var content = document.getElementById("lado_direito");

    // Verifica se o menu está visível ou não
    if (menu.classList.contains("hidden")) {
      // Se estiver oculto, torna visível
      menu.classList.remove("hidden");
      content.classList.remove("full-width");
    } else {
      // Se estiver visível, torna oculto
      menu.classList.add("hidden");
      content.classList.add("full-width");
    }
  }

  // Função para ajustar o tamanho do conteúdo quando a janela é redimensionada
    window.addEventListener("resize", function () {
    //var menu = document.getElementById("lado_esquerdo");
    var content = document.getElementById("lado_direito");

    // Verifica se o menu está oculto
    if (menu.classList.contains("hidden")) {
      // Se estiver oculto, expande o conteúdo para a largura total da janela
      content.classList.add("full-width");
    } else {
      // Se estiver visível, ajusta o conteúdo para a largura padrão
      content.classList.remove("full-width");
    }
  });

  function toggleSubMenu() {
        var submenu = $("#submenu");
        var submenuIcon = $("#submenu-icon");

        submenu.toggle();

        if (submenu.is(":visible")) {
          submenuIcon.text('arrow_drop_up');
        } else {
          submenuIcon.text('arrow_drop_down');
        }
      }


   function setSubmenuHeight() {
  const submenus = document.querySelectorAll('.menu li.expandable .submenu');
  submenus.forEach(submenu => {
    if (submenu.parentElement.classList.contains('active')) {
      submenu.style.maxHeight = submenu.scrollHeight + 'px';
    } else {
      submenu.style.maxHeight = '0';
    }
  });
}

</script>


</body>
</html>