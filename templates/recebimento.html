<!DOCTYPE html>
<html lang="pt-br">

  {% include 'head.html' %}

<head>
<link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"
    />
    <link rel="stylesheet" href="/static/css/meu_estilo.css" />

    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/1.5.3/perfect-scrollbar.min.js"></script>
    
    <script>
      $(function () {
        $('#tabs').tabs();
      });
    </script>
  <style>
    /* Adicione estilos CSS aqui para tornar o layout responsivo */
    .custom-label {
      display: block;
      margin-bottom: 8px;
    }

    .row {
      margin-right: -15px;
      margin-left: -15px;
    }

    .mb-3 {
      margin-bottom: 20px;
    }

    h3 {
      font-size: 20px;
      margin-top: 8px;
    }

    /* Adicione estilos para o scroll em dispositivos móveis */
    @media (max-width: 767px) {
      body {
        overflow-x: hidden;
      }

      .scrollable-content {
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        max-height: calc(100vh - 180px); /* Ajuste de altura máxima para rolagem */
      }

      .table-wrapper {
        overflow-x: auto;
      }

      .btn {
        padding: 10px 14px;
        font-size: 14px;
      }

      .floating-buttons {
        position: fixed;
        top: 40px;
        right: 10px;
        width: 60px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .floating-buttons .btn {
        margin-bottom: 8px;
      }

      .header span {
        display: block; /* Para colocar o texto "NOTH CROMO" abaixo de "RECEBIMENTO" */
      }
    }
  </style>

  <title>Recebimento de Ordens</title>
</head>

<body>
  <div id="superBody">
    <div class="header">
      <img
        src="https://drive.google.com/uc?export=view&id=1-grKAm790rFePojbqFxCeNXy4rHzrV4j"
        alt="Logo da Empresa"
      />
      <span>RECEBIMENTO - NOTH CROMO</span>
    </div>

    <div id="tabs">
    <ul>
        <li><a href="#tabs-1">Entrada</a></li>
        <li><a href="#tabs-2">Câmera</a></li>
        <li><a href="#tabs-3">Relatório</a></li>
      </ul>
       <div id="tabs-1" class="container">
        <!-- Campos de entrada -->
        <div class="row mt-3 scrollable-content">
            <!-- Campo Tipo de Ordem -->
            <div class="col-md-4 mb-3">
                <label for="tipoOrdem" class="custom-label">Tipo de Ordem</label>
                <select id="tipoOrdem" class="form-control">
                    <option value="novo">Novo</option>
                    <option value="nao">Não</option>
                </select>
            </div>
    
            <!-- Campo Número de Controle -->
            <div class="col-md-4 mb-3">
                <label for="numeroControle" class="custom-label">Número de Controle</label>
                <input
                    id="numeroControle"
                    type="text"
                    class="form-control"
                    placeholder="Automático"
                    disabled
                />
            </div>
    
            <!-- Campo Data de Recebimento -->
            <div class="col-md-4 mb-3">
                <label for="dataRecebimento" class="custom-label">Data de Recebimento</label>
                <input
                    id="dataRecebimento"
                    type="date"
                    class="form-control"
                    placeholder="Automático"
                    disabled
                />
            </div>

            <!-- Campo Cliente (ID do Cliente) -->
            <div class="col-md-4 mb-3">
                <label for="idCliente" class="custom-label">Cliente</label>
                <select id="idCliente" class="form-control">
                    <!-- Preencha com os clientes disponíveis -->
                </select>
            </div>
    
            <!-- Campo Quantidade -->
            <div class="col-md-4 mb-3">
                <label for="quantidade" class="custom-label">Quantidade</label>
                <input
                    id="quantidade"
                    type="number"
                    class="form-control"
                    placeholder="Quantidade"
                />
            </div>
    
            <!-- Campo Produto (Código do Produto) -->
            <div class="col-md-4 mb-3">
                <label for="codigoProduto" class="custom-label">Produto</label>
                <select id="codigoProduto" class="form-control">
                    <!-- Preencha com os produtos disponíveis -->
                </select>
            </div>

            <!-- Campo adicional Nota Interna -->
            <div class="col-md-4 mb-3">
                <label for="notaInterna" class="custom-label">Nota Interna</label>
                <input id="notaInterna" type="text" class="form-control" placeholder="N/A" />
            </div>

             <!-- Campo Número de Referência -->
             <div class="col-md-4 mb-3">
                <label for="numeroReferencia" class="custom-label">Número de Referência</label>
                <input
                    id="numeroReferencia"
                    type="text"
                    class="form-control"
                    placeholder="Número de Referência"
                />
            </div>
    
            <!-- Campo adicional Vendedor (ID do Vendedor) -->
            <div class="col-md-4 mb-3">
                <label for="idVendedor" class="custom-label">Vendedor</label>
                <select id="idVendedor" class="form-control">
                    <!-- Preencha com os vendedores disponíveis -->
                </select>
            </div>
    
            <!-- Campo adicional Queixa do Cliente -->
            <div class="col-md-12 mb-3">
                <label for="queixaCliente" class="custom-label">Obs:</label>
                <textarea id="queixaCliente" class="form-control" rows="1" oninput="autoResize(this)"></textarea>
            </div>
        </div>
    </div>
    
        <!-- Inputs ocultos para armazenar IDs únicos -->
        <input type="hidden" id="id_Num_Orcamento" value="seu_valor_aqui_para_Num_Orcamento" />
        <input type="hidden" id="id_ValorSeg_numero_Controle" value="seu_valor_aqui_para_ValorSeg_numero_Controle" />
        <input type="hidden" id="id_NovoIDNovo_numero_Controle" value="seu_valor_aqui_para_NovoIDNovo_numero_Controle" />


        <!-- Tabela Tabular -->
        <div class="table-responsive myTable table-wrapper scrollable-content">
          <div id="table_Recebimento" class="tabulator myTable"></div>
        </div>

        <!-- Botões flutuantes -->
        <div class="floating-buttons">
          <button id="btn_adiciona_funcionario" onclick="Adicionar_funcionarios_mostrarAlerta()" class="btn" style="background-color: #4caf50; color: white;">
            <span class="material-icons" style="margin-right: 8px">save</span>
            Salvar Dados
          </button>

          <button id="btn_excluir_funcioario" onclick="excluir_funcioario()" class="btn" style="background-color: #f44336; color: white;">
            <span class="material-icons" style="margin-right: 8px">delete</span>
            Excluir Dados
          </button>

          <button id="btn_editar_dados" onclick="editar_funcionario()" class="btn" style="background-color: #2196f3; color: white;">
            <span class="material-icons" style="margin-right: 8px">edit</span>
            Editar Dados
          </button>
        </div>
      </div>
      <!-- Fechando a div 'tab-pane' -->

      <!-- Câmera -->
            <div id="tabs-2" class="container">
              <!-- Conteúdo da guia do relatório -->
              <!-- Inclua aqui o código para o relatório -->
            </div>
            <!-- Fechando a div 'tab-pane' -->
          </div>

      <!-- Relatório -->
      <div id="tabs-3" class="container">
        <!-- Conteúdo da guia do relatório -->
        <!-- Inclua aqui o código para o relatório -->
      </div>
      <!-- Fechando a div 'tab-pane' -->
    </div>
    <!-- Fechando a div 'tabs' -->
    <!-- Adicione o script para a biblioteca Perfect Scrollbar e sua inicialização -->
        {% include 'funcoes_comuns.html' %}
        <!-- <script src="capturar_foto.js"></script> -->
        <script>
          function my_url() {
            if (window.location.href.slice(0, 22) == 'http://127.0.0.1:5000/') {
              return 'http://127.0.0.1:5000/';
            } else {
              return 'https://www.northcromocontrole.com.br/';
            }
          }
  
          function uploadFile() {
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];
  
            if (file) {
              var formData = new FormData();
              formData.append('file', file);
  
              $.ajax({
                type: 'POST',
                url: my_url() + 'upload',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                  console.log('File uploaded successfully:', response);
                },
                error: function (error) {
                  console.error('Error uploading file:', error);
                },
              });
            } else {
              console.error('No file selected');
            }
          }
        </script>

      <script>
 // Varivavel para o ApiScript

 var minhaUrl =
       'https://script.google.com/macros/s/AKfycbyKbCEorAKW_U4alzQvPfWuYb7Gpu1B1ZxrnnINNmYo92W5EKOiK-wIakk2vp8tj88/exec'
       
function formatarData(data) {
    const partes = data.split('-');
    const dataFormatada = partes[2] + '/' + partes[1] + '/' + partes[0];
    return dataFormatada;
  
  }
  $(document).ready(function () {
  // Chamar a função horaSistema para definir a hora atual
  horaSistema();

  // Formatar campo de telefone
  $('#telefone').keyup(function () {
    var val = this.value.replace(/\D/g, '');
    var newVal = '';
    while (val.length > 0) {
      newVal += (val.length > 2 ? ' ' : '') + val.substr(0, 2);
      val = val.substr(2);
    }
    this.value = newVal.trim();
  });

  // Adicionar estilo ao campo quando preenchido
  $('input').blur(function () {
    if ($(this).val()) {
      $(this).addClass('filled');
    } else {
      $(this).removeClass('filled');
    }
  });

  $(".scrollable-content").perfectScrollbar();

});

function autoResize(element) {
  element.style.height = 'auto';
  element.style.height = (element.scrollHeight) + 'px';
};

// Função para definir a hora atual no campo
function horaSistema() {
  const horaAtualInput = document.getElementById('horaAtual');
  if (horaAtualInput !== null) {
    // Continue com a manipulação apenas se o elemento existir
    horaAtualInput.value = "Nova hora";

    const agora = new Date();
    // Formatar a hora atual para hh:mm
    const horaAtual = agora.getHours().toString().padStart(2, '0');
    const minutoAtual = agora.getMinutes().toString().padStart(2, '0');
    const horaFormatada = `${horaAtual}:${minutoAtual}`;

    // Atribuir a hora formatada ao input
    horaAtualInput.value = horaFormatada;
  }
}


document.addEventListener('DOMContentLoaded', function () {
  const btnGroup = document.querySelector('.btn-group');
  const hiddenInput = document.getElementById('marcaNovo');

  btnGroup.addEventListener('click', function (event) {
    const target = event.target;
    if (target.tagName === 'BUTTON') {
      const value = target.getAttribute('data-value');
      hiddenInput.value = value;
    }
  });
});

// Script para definir a hora atual no campo
document.addEventListener('DOMContentLoaded', function () {
  const horaAtualInput = document.getElementById('horaAtual');
  const agora = new Date();

  // Formatar a hora atual para hh:mm
  const horaAtual = agora.getHours().toString().padStart(2, '0');
  const minutoAtual = agora.getMinutes().toString().padStart(2, '0');
  const horaFormatada = `${horaAtual}:${minutoAtual}`;

  horaAtualInput.value = horaFormatada;
});

const video = document.getElementById('camera-feed');
const capturarBotao = document.getElementById('capturar-foto');
const cameraFrenteBotao = document.getElementById(
  'capturar-camera-frente'
);
const cameraTransBotao = document.getElementById(
  'capturar-camera-trans'
);
const desativarCameraBotao =
  document.getElementById('desativar-camera');
const canvas = document.getElementById('foto-capturada');

let currentStream;

function startCamera(streamOptions) {
  navigator.mediaDevices
    .getUserMedia(streamOptions)
    .then(function (stream) {
      video.srcObject = stream;
      currentStream = stream;
    })
    .catch(function (error) {
      console.log('Erro ao acessar a câmera: ' + error);
    });
}

function stopCamera() {
  if (currentStream) {
    const tracks = currentStream.getTracks();
    tracks.forEach((track) => track.stop());
    video.srcObject = null;
  }
}

function capturePhoto() {
  canvas.style.display = 'block';
  video.style.display = 'none';
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas
    .getContext('2d')
    .drawImage(video, 0, 0, canvas.width, canvas.height);

  const dataURL = canvas.toDataURL('image/jpeg');

  fetch('/upload', {
    method: 'POST',
    body: JSON.stringify({ photo: dataURL }),
    headers: {
      'Content-Type': 'application/json',
    },
  })
    .then((response) => response.text())
    .then((result) => alert(result))
    .catch((error) => console.error(error));
}

capturarBotao.addEventListener('click', capturePhoto);

cameraFrenteBotao.addEventListener('click', function () {
  stopCamera();
  startCamera({ video: { facingMode: 'user' } });
});

cameraTransBotao.addEventListener('click', function () {
  stopCamera();
  startCamera({ video: { facingMode: { exact: 'environment' } } });
});

desativarCameraBotao.addEventListener('click', function () {
  stopCamera();
  video.style.display = 'none';
});

</script>

<!-- Adicione este script no final do body da sua página -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha512-GLbCKLNBXVnDYbWEQaQ3Q2jA2j//b6ZFYyyxvIqxUpn8Oy4z8JUODf60gqV7zvPe7ME1aGrg5ZLysl1mg1yDAw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/1.5.3/perfect-scrollbar.min.js"></script>

  </div>
  </body>
</html>